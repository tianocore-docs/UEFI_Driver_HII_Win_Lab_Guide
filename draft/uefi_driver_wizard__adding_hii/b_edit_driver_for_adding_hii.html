
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>b. Edit Driver for adding HII   · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="2_updating_hii_to_save_data_settings.html" />
    
    
    <link rel="prev" href="a_setup_for_lab_adding_hii.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    UEFI_Driver_HII_Win_Lab_Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    UEFI Driver Wizard – Adding HII Labs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="1_adding_strings_and_forms_to_setup_hii_for_user_c.html">
            
                <a href="1_adding_strings_and_forms_to_setup_hii_for_user_c.html">
            
                    
                    Lab 1. Adding Strings and Forms to Setup HII for User Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="a_setup_for_lab_adding_hii.html">
            
                <a href="a_setup_for_lab_adding_hii.html">
            
                    
                    a. Setup for Lab adding HII 
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.3" data-path="b_edit_driver_for_adding_hii.html">
            
                <a href="b_edit_driver_for_adding_hii.html">
            
                    
                    b. Edit Driver for adding HII  
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="2_updating_hii_to_save_data_settings.html">
            
                <a href="2_updating_hii_to_save_data_settings.html">
            
                    
                    Lab 2. Updating HII to Save Data Settings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="3_updating_your_driver_to_initialize_data_from_the.html">
            
                <a href="3_updating_your_driver_to_initialize_data_from_the.html">
            
                    
                    Lab 3. Updating your driver to initialize data from the VFR data to the HII Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="4_updating_the_menu_reset_button.html">
            
                <a href="4_updating_the_menu_reset_button.html">
            
                    
                    Lab 4. Updating the Menu:  Reset Button
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="5_updating_the_menu_pop_-up_box.html">
            
                <a href="5_updating_the_menu_pop_-up_box.html">
            
                    
                    Lab 5. Updating the Menu:  Pop-up Box
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="6_updating_the_menu_creating_a_string_to_name_a_sa.html">
            
                <a href="6_updating_the_menu_creating_a_string_to_name_a_sa.html">
            
                    
                    Lab 6. Updating the Menu:  Creating a String to Name a Saved Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="7_updating_the_menu_numeric_entry.html">
            
                <a href="7_updating_the_menu_numeric_entry.html">
            
                    
                    Lab 7. Updating the Menu:  Numeric Entry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="8_updating_your_driver_for_interactive_call_backs.html">
            
                <a href="8_updating_your_driver_for_interactive_call_backs.html">
            
                    
                    Lab 8. Updating your Driver for Interactive Call Backs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="9_add_code_to_your_driver_when_call_back_events_oc.html">
            
                <a href="9_add_code_to_your_driver_when_call_back_events_oc.html">
            
                    
                    Lab 9. Add code to your driver when Call Back events occur for Interactive Items
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="10_adding_an_additional_form_page.html">
            
                <a href="10_adding_an_additional_form_page.html">
            
                    
                    Lab 10. Adding an Additional Form Page
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="11_adding_communication_from_driver_to_console_thr.html">
            
                <a href="11_adding_communication_from_driver_to_console_thr.html">
            
                    
                    Lab 11. Adding Communication from Driver to Console through HII
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../lab_setup/">
            
                <a href="../lab_setup/">
            
                    
                    Lab Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../microsoft_windows_10__visual_studio_command_prompt.html">
            
                <a href="../microsoft_windows_10__visual_studio_command_prompt.html">
            
                    
                    Microsoft Windows 10 – Visual Studio command prompt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../reference.html">
            
                <a href="../reference.html">
            
                    
                    Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../microsoft_windows_and_visual_studio_matrix/">
            
                <a href="../microsoft_windows_and_visual_studio_matrix/">
            
                    
                    Microsoft Windows and Visual Studio Matrix 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../microsoft_windows_and_visual_studio_matrix/glossary_of_uefi_terms_and_acronyms.html">
            
                <a href="../microsoft_windows_and_visual_studio_matrix/glossary_of_uefi_terms_and_acronyms.html">
            
                    
                    Glossary of UEFI Terms and Acronyms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../microsoft_windows_and_visual_studio_matrix/helpful_links.html">
            
                <a href="../microsoft_windows_and_visual_studio_matrix/helpful_links.html">
            
                    
                    Helpful Links
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

	
    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >b. Edit Driver for adding HII  </a>
    </h1>
</div>
<div>
    <!-- 
    <img style="float:left; align:middle; height:2em" src="media/TianocoreTitlePageLogo.jpg"/>
     -->
    
      <h2>
        <div style="position:absolute;text-align:left">UEFI Driver HII Win Lab Guide</div>
        <div style="position:absolute;width:100%;text-align:center">DRAFT </div>
        <div style="text-align:right">Revision 01.0</div>
      </h2>  
    
    <hr>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <!--- @file
 file b-edit-driver-for-adding-hii


Copyright (c) 2018, Intel Corporation. All rights reserved.<BR>

Redistribution and use in source (original document form) and 'compiled'
forms (converted to PDF, epub, HTML and other formats) with or without
modification, are permitted provided that the following conditions are met:

1) Redistributions of source code (original document form) must retain the
above copyright notice, this list of conditions and the following
disclaimer as the first lines of this file unmodified.

2) Redistributions in compiled form (transformed to other DTDs, converted to
PDF, epub, HTML and other formats) must reproduce the above copyright
notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the distribution.

THIS DOCUMENTATION IS PROVIDED BY TIANOCORE PROJECT "AS IS" AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
EVENT SHALL TIANOCORE PROJECT BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<h2 id="b-edit-driver-for-adding-hii">Lab 1 b. Edit Driver for adding HII </h2>
<ol>
<li><strong>Open</strong> C:\fw\edk2\MyWizardDriver </li>
<li><strong>Open</strong> the following files for updating: <ul>
<li>MyWizardDriverNVDataStruc.h</li>
<li>MyWizardDriver.vfr</li>
<li>MyWizardDriver.uni</li>
<li>MyWizardDriver.h</li>
<li>MyWizardDriver.c</li>
<li>MyWizardDriver.inf</li>
</ul>
</li>
<li><strong>Update</strong> the MyWizardDriverNVDataStruc.h file by copying and pasting the following GUID as shown below: This GUID is used to communicate to the HII Database and Browser Engine<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MYWIZARDDRIVER_FORMSET_GUID \
{ \
0x5481db09, 0xe5f7, 0x4158, 0xa5, 0xc5, 0x2d, 0xbe, 0xa4, 0x95, 0x34, 0xff \
}</span>
</code></pre>
<img src="../media/image8.png" alt=""></li>
<li><strong>Save</strong> MyWizardDriverNVDataStruc.h </li>
<li><p><strong>Update</strong> the <strong>MyWizardDriver.vfr</strong> file. <strong>Delete</strong> its contents and <strong>replace</strong> it with the following by copying and pasting: You&#x2019;re adding a reference to the GUID and to the NVRAM storage where the configuration will be saved. In fact, you&#x2019;re replacing most of the original .vfr.</p>
<pre><code>#include &quot;MyWizardDriverNVDataStruc.h&quot;
formset
guid     = MYWIZARDDRIVER_FORMSET_GUID,
title    = STRING_TOKEN(STR_SAMPLE_FORM_SET_TITLE),
help     = STRING_TOKEN(STR_SAMPLE_FORM_SET_HELP),
classguid = EFI_HII_PLATFORM_SETUP_FORMSET_GUID,

//
// Define a Buffer Storage (EFI_IFR_VARSTORE)
//
 varstore MYWIZARDDRIVER_CONFIGURATION,  // This is the data structure type
 //varid = CONFIGURATION_VARSTORE_ID,      // Optional VarStore ID
 name  = MWD_IfrNVData,                  // Define referenced name in vfr
 guid  = MYWIZARDDRIVER_FORMSET_GUID;    // GUID of this buffer storage
</code></pre></li>
<li>Continue <strong>adding</strong> the remaining code to MyWizardDriver.vfr. This is a Enable/ Disable question for the setup menu in the form of a Check box.</li>
</ol>
<pre><code>
 form formid = 1, title = STRING_TOKEN(STR_SAMPLE_FORM1_TITLE);
    subtitle text = STRING_TOKEN(STR_SUBTITLE_TEXT);

    subtitle text = STRING_TOKEN(STR_SUBTITLE_TEXT2);
  //
  // Define a checkbox to enable / disable the device
  //
      checkbox varid   = MWD_IfrNVData.MyWizardDriverChooseToEnable,
                 prompt   = STRING_TOKEN(STR_CHECK_BOX_PROMPT),
                 help     = STRING_TOKEN(STR_CHECK_BOX_HELP),
                 //
                 // CHECKBOX_DEFAULT indicate this checkbox is marked
              //   with EFI_IFR_CHECKBOX_DEFAULT
                 // 
                 flags    = CHECKBOX_DEFAULT ,
                 key      = 0,
                 default  = 1,
     endcheckbox;

   endform;

endformset;
</code></pre><p>7). <strong>Save</strong> MyWizardDriver.vfr <br></p>
<p>8). <strong>Update </strong> MyWizardDriver.uni file. You&#x2019;ll add new strings to support the forms. <strong>Delete</strong> the file&#x2019;s content and <strong>replace</strong> it with the following by copying and pasting: </p>
<pre><code>
  #langdef en &quot;English&quot;

  #string STR_SAMPLE_FORM_SET_TITLE      #language en  &quot;My Wizard  Driver Sample Formset&quot;
  #string STR_SAMPLE_FORM_SET_HELP       #language en  &quot;Help for Sample Formset&quot;
  #string STR_SAMPLE_FORM1_TITLE         #language en  &quot;My Wizard Driver&quot;

  #string STR_SUBTITLE_TEXT              #language en &quot;My Wizard Driver Configuration&quot;
  #string STR_SUBTITLE_TEXT2             #language en &quot;Device XYZ Configuration&quot;
  #string STR_CHECK_BOX_PROMPT           #language en &quot;Enable My XYZ Device&quot;

  #string STR_CHECK_BOX_HELP             #language en &quot;This is the help message for the enable My XYZ device. Check this box to enable this device.&quot;
</code></pre><p>9). <strong>Save</strong> MyWizardDriver.uni <br>
10). <strong>Update</strong> the MyWizardDriver.h file. <strong>Add</strong> the following HII libraries starting at approximately line 41 (as shown below) by copying and pasting: </p>
<pre><code>// Added for HII
#include &lt;Protocol/HiiConfigRouting.h&gt;  
#include &lt;Protocol/FormBrowser2.h&gt;  
#include &lt;Protocol/HiiString.h&gt; 
#include &lt;Library/DevicePathLib.h&gt;
</code></pre><p><img src="../media/image9.png" alt=""><br>
11). To add a data structure for HII routing and access, <strong>add</strong> the following code at approximately line 75 by copying and pasting after the &#x201C;<code>extern</code>&#x201D; statements: </p>
<pre><code>   #define MYWIZARDDRIVER_DEV_SIGNATURE SIGNATURE_32 (&apos;m&apos;, &apos;w&apos;, &apos;d&apos;, &apos;r&apos;)  

// Need a Data structure for HII routing and accessing
typedef struct {
  UINT32                           Signature;

  EFI_HANDLE                       Handle;
  MYWIZARDDRIVER_CONFIGURATION        Configuration;  
  EFI_HANDLE                       DriverHandle[2];  
  EFI_HII_HANDLE                   HiiHandle[2];
  //
  // Consumed protocol
  //
  EFI_HII_DATABASE_PROTOCOL        *HiiDatabase;  
  EFI_HII_STRING_PROTOCOL          *HiiString; 
  EFI_HII_CONFIG_ROUTING_PROTOCOL  *HiiConfigRouting;  
  EFI_FORM_BROWSER2_PROTOCOL       *FormBrowser2; 

  //
  // Produced protocol
  //
  EFI_HII_CONFIG_ACCESS_PROTOCOL   ConfigAccess;  

} MYWIZARDDRIVER_DEV;

  #define MYWIZARDDRIVER_DEV_FROM_THIS(a)  CR (a, MYWIZARDDRIVER_DEV, ConfigAccess, MYWIZARDDRIVER_DEV_SIGNATURE)

  #pragma pack(1)
///
/// HII specific Vendor Device Path definition.
///
typedef struct {
  VENDOR_DEVICE_PATH             VendorDevicePath;
  EFI_DEVICE_PATH_PROTOCOL       End;
} HII_VENDOR_DEVICE_PATH;

  #pragma pack()
</code></pre><p><img src="../media/image10.png" alt=""><br>
12).  <strong>Save</strong> MyWizardDriver.h <br></p>
<p>13). <strong> Update</strong>  MyWizardDriver.c file. <br> <strong>Add</strong> local definitions for the form GUID, variable name, and device path for HII at approximately line 13 after the <code>#include &quot;MyWizardDriver.h&quot;</code> by coping and pasting the following code. <br>In this step, you declare a local (to the module &#x201C;<code>m</code>&#x201D;) variable for the GUID we declared; the NVRAM variable name; driver handles; our configuration data; and the device path support.</p>
<pre><code>// Begin code 
//HII support
EFI_GUID   mMyWizardDriverFormSetGuid = MYWIZARDDRIVER_FORMSET_GUID;

CHAR16     mIfrVariableName[] = L&quot;MWD_IfrNVData&quot;;
EFI_HANDLE                      mDriverHandle[2] = {NULL, NULL};
MYWIZARDDRIVER_DEV         *PrivateData = NULL;

// HII support for Device Path
HII_VENDOR_DEVICE_PATH  mHiiVendorDevicePath = {
  {
    {
      HARDWARE_DEVICE_PATH,
      HW_VENDOR_DP,
      {
        (UINT8) (sizeof (VENDOR_DEVICE_PATH)),
        (UINT8) ((sizeof (VENDOR_DEVICE_PATH)) &gt;&gt; 8)
      }
    },
    MYWIZARDDRIVER_FORMSET_GUID
  },
  {
    END_DEVICE_PATH_TYPE,
    END_ENTIRE_DEVICE_PATH_SUBTYPE,
    {
      (UINT8) (END_DEVICE_PATH_LENGTH),
      (UINT8) ((END_DEVICE_PATH_LENGTH) &gt;&gt; 8)
    }
  }
};
// end code
</code></pre><p>14). <strong>Locate</strong> EFI_STATUS within the function <code>MyWizardDriverDriverEntryPoint</code> in the <code>MyWizardDriver.c</code>file (approx. Line 184) and <strong>add</strong> HII local definitions by copying and pasting (as shown below): </p>
<pre><code> // HII Locals
  EFI_HII_PACKAGE_LIST_HEADER     *PackageListHeader;
  EFI_HII_DATABASE_PROTOCOL       *HiiDatabase;
  EFI_HII_HANDLE                   HiiHandle[2];
  EFI_STRING                       ConfigRequestHdr;
  UINTN                            BufferSize;
</code></pre><p><img src="../media/image11.png" alt=""><br>
15).  <strong>Locate</strong> the <strong>ASSERT_EFI_ERROR (Status);</strong> statement and the line: <strong>// Retrieve HII Package List Header on ImageHandle</strong> (approximately line 202). Now, <strong>add</strong> the following code to install the configuration access protocol (produced) by copying and pasting (as shown below) before the line: <strong>// Retrieve HII Package List Header on ImageHandle</strong> </p>
<pre><code class="lang-c"><span class="hljs-comment">//Now do HII Stuff</span>
<span class="hljs-comment">// Initialize the local variables.</span>
  ConfigRequestHdr = <span class="hljs-literal">NULL</span>;

<span class="hljs-comment">// Initialize driver private data</span>
  PrivateData = AllocateZeroPool (<span class="hljs-keyword">sizeof</span> (MYWIZARDDRIVER_DEV));
  <span class="hljs-keyword">if</span> (PrivateData == <span class="hljs-literal">NULL</span>) {
    <span class="hljs-keyword">return</span> EFI_OUT_OF_RESOURCES;
  }

  PrivateData-&gt;Signature = MYWIZARDDRIVER_DEV_SIGNATURE;

  PrivateData-&gt;ConfigAccess.ExtractConfig = MyWizardDriverHiiConfigAccessExtractConfig;
  PrivateData-&gt;ConfigAccess.RouteConfig = MyWizardDriverHiiConfigAccessRouteConfig;
  PrivateData-&gt;ConfigAccess.Callback = MyWizardDriverHiiConfigAccessCallback;

  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Publish sample Fromset and config access </span>
  <span class="hljs-comment">//</span>
  Status = gBS-&gt;InstallMultipleProtocolInterfaces (
                  &amp;mDriverHandle[<span class="hljs-number">0</span>],
                  &amp;gEfiDevicePathProtocolGuid,
                  &amp;mHiiVendorDevicePath,
                  &amp;gEfiHiiConfigAccessProtocolGuid,
                  &amp;PrivateData-&gt;ConfigAccess,
                  <span class="hljs-literal">NULL</span>
                  );
  ASSERT_EFI_ERROR (Status);

  PrivateData-&gt;DriverHandle[<span class="hljs-number">0</span>] = mDriverHandle[<span class="hljs-number">0</span>];
<span class="hljs-comment">// end code</span>
</code></pre>
<p><img src="../media/image12.png" alt=""><br>
16).  Next, <strong>add</strong> code to register a list of HII packages in the HII Database with the HII device path. This requires you to <strong>replace</strong> existing code (see below) by copying and pasting the new code at approx. line 265. 
<br><strong>Old Code</strong><br>
<img src="../media/image13.png" alt=""><br>
<code>mDriverHandle[0],</code><br>
<code>&amp;HiiHandle[0]</code><br>
<br><strong>New Code</strong> <br>
<img src="../media/image14.png" alt=""><br>
17). Next, you&#x2019;ll <strong>add</strong> code to initialize the My Wizard Driver NVRAM variable by copying and pasting the following code <strong>before</strong> the<code>// Install Driver Supported EFI Version Protocol onto ImageHandle</code> comment (as shown below at approximately line 273): </p>
<pre><code> // Begin code
 PrivateData-&gt;HiiHandle[0] = HiiHandle[0];

  BufferSize = sizeof (MYWIZARDDRIVER_CONFIGURATION);

  // IF driver is not part of the Platform then need to get/set defaults for the NVRAM configuration that the driver will use.
  Status = gRT-&gt;GetVariable (
            mIfrVariableName,
            &amp;mMyWizardDriverFormSetGuid,
            NULL,
            &amp;BufferSize,
            &amp;PrivateData-&gt;Configuration
            );
  if (EFI_ERROR (Status)) {  // Not definded yet so add it to the NV Variables.
        // zero out buffer
        ZeroMem (&amp;PrivateData-&gt;Configuration, sizeof (MYWIZARDDRIVER_CONFIGURATION));
        Status = gRT-&gt;SetVariable(
                  mIfrVariableName,
                  &amp;mMyWizardDriverFormSetGuid,
                  EFI_VARIABLE_NON_VOLATILE | EFI_VARIABLE_BOOTSERVICE_ACCESS,
                  sizeof (MYWIZARDDRIVER_CONFIGURATION),
                  &amp;PrivateData-&gt;Configuration   //  buffer is 000000  now
                  );
  }
// end code
</code></pre><p><img src="../media/image15.png" alt=""><br>
18). <strong>Save</strong> MyWizardDriver.c <br>
19). Now onto the final file, MyWizardDriver.inf. <strong>Add</strong> the following protocols in the [protocols] section that are being used by copying and pasting (as shown below): </p>
<pre><code>gEfiHiiStringProtocolGuid                   ## CONSUMES
gEfiHiiConfigRoutingProtocolGuid            ## CONSUMES
gEfiFormBrowser2ProtocolGuid                ## CONSUMES
gEfiHiiDatabaseProtocolGuid                 ## CONSUMES
</code></pre><p><img src="../media/image16.png" alt=""><br>
20). <strong>Save</strong> the MyWizardDriver.inf file. All the files should be saved at this point. <br>
21). <strong>Add</strong> MyWizardDriver.inf to the Nt32Pkg.dsc(See Lab 2building MyWizardDriver from the Driver Porting Lab) </p>
<h4 id="build-and-test-mywizarddriver">Build and test MyWizardDriver</h4>
<ol>
<li><strong>Re-Open</strong> the Visual Studio Command Prompt </li>
<li><strong>Type</strong> build </li>
<li><strong>Type</strong> build run </li>
<li><strong>At the UEFI Shell prompt,type</strong> fs0: </li>
<li><strong>Type</strong> Load MyWizardDriver.efi </li>
<li><strong>Press</strong> &#x201C;Enter&#x201D; This will load your driver into memory 
<img src="../media/image17.png" alt=""></li>
<li><strong>Type</strong> exit </li>
<li>Now at the setup front page menu,<strong> select </strong>&#x201C;Device Manager&#x201D;
<img src="../media/image18.png" alt=""></li>
<li><strong>Press</strong> &#x201C;Enter&#x201D;  to enter <strong>&#x201C;Device Manager&#x201D;</strong></li>
<li><p><strong>Inside the Device Manager menu</strong> press <strong>the down to &#x201C;My Wizard Driver Sample Formset&#x201D;**</strong> <strong>Press</strong> &quot;Enter&quot;
<img src="../media/image19.png" alt=""><br>
<strong>Press</strong> &quot;Enter&quot;
<img src="../media/image20.png" alt=""><br>
<strong><em>Note</em>:</strong> Notice that your form is now displayed with a choice to enable your device. Also notice the titles and help strings that are in the .UNI file you edited. <br>At this point since the HII configuration routing functions are not functional the values (Enable/ Disable) will not be saved to NVRAM. The next lab will update the HII Extract, Route, and call back functions for the HII configuration routing protocol your driver will produce.</p>
</li>
<li><p><strong>Press</strong> the space bar to Enable and Disable the &#x201C;Enable My XYZ Device&#x201D; </p>
</li>
<li><strong>Press</strong> F10 to attempt to save 
<img src="../media/image21.png" alt="">
<img src="../media/image22.png" alt=""><br>
<strong><em>Note</em>:</strong> You&#x2019;re not able to save the data changes at this point.</li>
<li><strong>Press </strong>&#x201C;Enter&#x201D;<em>**</em> </li>
<li><strong>Press </strong>&#x201C;Escape&#x201D;, and then &#x201C;Y&#x201D; to exit<em>*</em></li>
<li><strong><strong>To Exit the &#x201C;Device Manager&#x201D; Page: Press &#x201C;Escape&#x201D;</strong></strong> 
<img src="../media/image23.png" alt=""></li>
<li><strong>Press </strong>Up Arrow to &#x201C;Continue&#x201D;<em>**</em> 
<img src="../media/image24.png" alt=""></li>
<li><strong>At the Shell prompt</strong> type <strong>Reset</strong><br>
<img src="../media/image97.png" alt=""></li>
<li><strong>Press</strong> &#x201C;Enter&#x201D; to return to the Visual Studio Command Prompt 
<img src="../media/image26.png" alt=""></li>
</ol>
<hr>
<p>You&#x2019;ve completed the first lab and added strings and forms to setup HII for user configuration. However, <strong>the data is not saved to NVRAM</strong>. In the next lab, you&#x2019;ll learn how to update HII to save data to NVRAM.</p>
<p>For any build issues copy the solution files from C:\Fw\LabSolutions\LessonE.1A</p>
<h3 id="end-of-lab-1">end of Lab 1</h3>

                                
                                </section>
                            
                        </div>
                    </div>
                    
                    

<div>
    <hr>
    
      <h2>
        <div style="position:absolute;text-align:left">UEFI Driver HII Win Lab Guide</div>
        <div style="position:absolute;width:100%;text-align:center">DRAFT </div>
        <div style="text-align:right">Revision 01.0</div>
      </h2>  
    
</div>



                
            </div>

            
                
                <a href="a_setup_for_lab_adding_hii.html" class="navigation navigation-prev " aria-label="Previous page: a. Setup for Lab adding HII ">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="2_updating_hii_to_save_data_settings.html" class="navigation navigation-next " aria-label="Next page: Lab 2. Updating HII to Save Data Settings">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"b. Edit Driver for adding HII  ","level":"1.2.3","depth":2,"next":{"title":"Lab 2. Updating HII to Save Data Settings","level":"1.2.4","depth":2,"path":"uefi_driver_wizard__adding_hii/2_updating_hii_to_save_data_settings.md","ref":"uefi_driver_wizard__adding_hii/2_updating_hii_to_save_data_settings.md","articles":[]},"previous":{"title":"a. Setup for Lab adding HII ","level":"1.2.2","depth":2,"path":"uefi_driver_wizard__adding_hii/a_setup_for_lab_adding_hii.md","ref":"uefi_driver_wizard__adding_hii/a_setup_for_lab_adding_hii.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"draft":"yes","title":"UEFI Driver HII Win Lab Guide","version":"Revision 01.0"},"plugins":["puml-aleung"],"pluginsConfig":{"puml-aleung":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"uefi_driver_wizard__adding_hii/b_edit_driver_for_adding_hii.md","mtime":"2020-12-01T06:56:49.304Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-01T06:57:18.936Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

